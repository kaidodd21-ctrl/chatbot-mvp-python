<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kai â€¢ Virtual Assistant</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="chat-container">
    <header>
      <h2>Kai â€¢ Virtual Assistant</h2>
      <div class="status">ðŸŸ¢ Online now</div>
      <button onclick="restartChat()">âŸ³ Restart</button>
    </header>

    <div id="chat-box"></div>

    <div id="input-container">
      <input id="user-input" type="text" placeholder="Type a message..." />
      <button onclick="handleSend()">Send</button>
    </div>
  </div>

  <script>
  const BACKEND_URL = "http://127.0.0.1:8000/chat"; // replace with Render URL after deploy

  function addUserMessage(text) {
    const chatBox = document.getElementById("chat-box");
    const msgWrapper = document.createElement("div");
    msgWrapper.className = "message user";
    const statusId = "status-" + Date.now();

    msgWrapper.innerHTML = `
      <div class="avatar"></div>
      <div class="bubble">${text}</div>
      <div class="status" id="${statusId}">âœ“ Sent</div>
    `;

    chatBox.appendChild(msgWrapper);
    chatBox.scrollTop = chatBox.scrollHeight;

    return document.getElementById(statusId);
  }

  function addBotMessage(text, suggestions = []) {
    const chatBox = document.getElementById("chat-box");
    const msgWrapper = document.createElement("div");
    msgWrapper.className = "message bot";
    msgWrapper.innerHTML = `
      <div class="avatar"></div>
      <div class="bubble">${text}</div>
    `;
    chatBox.appendChild(msgWrapper);

    if (suggestions.length > 0) {
      const suggBox = document.createElement("div");
      suggBox.className = "suggestions";
      suggestions.forEach(s => {
        const btn = document.createElement("button");
        btn.innerText = s;
        btn.onclick = () => sendMessage(s);
        suggBox.appendChild(btn);
      });
      chatBox.appendChild(suggBox);
    }

    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function showTyping() {
    const chatBox = document.getElementById("chat-box");
    const typingDiv = document.createElement("div");
    typingDiv.id = "typing";
    typingDiv.className = "message bot";
    typingDiv.innerHTML = `
      <div class="avatar"></div>
      <div class="bubble typing">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>`;
    chatBox.appendChild(typingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function hideTyping() {
    const typingDiv = document.getElementById("typing");
    if (typingDiv) typingDiv.remove();
  }

  async function sendMessage(text) {
    const statusEl = addUserMessage(text);
    document.getElementById("user-input").value = "";

    showTyping();

    const res = await fetch(BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });
    const data = await res.json();

    // Simulated typing delay
    setTimeout(() => {
      hideTyping();
      addBotMessage(data.reply, data.suggestions);
      statusEl.innerText = "âœ“âœ“ Read";
    }, Math.floor(Math.random() * 1000) + 500);
  }

  function handleSend() {
    const input = document.getElementById("user-input").value.trim();
    if (input) sendMessage(input);
  }

  function restartChat() {
    document.getElementById("chat-box").innerHTML = "";
    addBotMessage(
      "Hi ðŸ‘‹ Iâ€™m Kai, your assistant. How can I help today?",
      ["Make a booking", "Opening hours", "Contact details"]
    );
  }

  window.onload = restartChat;
  </script>
</body>
</html>
