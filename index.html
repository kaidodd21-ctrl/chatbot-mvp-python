<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kai • Virtual Assistant</title>
<style>
  body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background:#f5f7fb; }
  .chat-container { max-width: 800px; margin: 20px auto; background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 20px rgba(0,0,0,.08); }
  .header { background:#2e9153; color:#fff; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; }
  .header .status { font-size:14px; }
  .header button { background:none; border:none; color:#fff; cursor:pointer; font-size:14px; }
  #chat-box { height:500px; overflow-y:auto; padding:16px; }
  .row { display:flex; margin-bottom:10px; }
  .bot { justify-content:flex-start; }
  .user { justify-content:flex-end; }
  .bubble { padding:10px 14px; border-radius:16px; max-width:65%; line-height:1.4; }
  .bot .bubble { background:#eef2f3; color:#111; border-bottom-left-radius:4px; }
  .user .bubble { background:#2e9153; color:#fff; border-bottom-right-radius:4px; }
  .meta { font-size:11px; color:#999; margin-top:2px; }
  .input-area { display:flex; border-top:1px solid #ddd; }
  #user-input { flex:1; padding:12px; border:none; font-size:15px; outline:none; }
  #send-btn { background:#2e9153; color:#fff; border:none; padding:0 20px; cursor:pointer; }
  #suggestions { display:flex; gap:8px; flex-wrap:wrap; padding:8px 16px; border-top:1px solid #eee; }
  #suggestions button { border:1px solid #ccc; background:#fff; border-radius:16px; padding:6px 12px; cursor:pointer; }
</style>
</head>
<body>
<div class="chat-container">
  <div class="header">
    <div>Kai • Virtual Assistant</div>
    <div class="status">🟢 Online now</div>
    <button onclick="restartChat()">⟳ Restart</button>
  </div>
  <div id="chat-box"></div>
  <div id="suggestions"></div>
  <div class="input-area">
    <input id="user-input" type="text" placeholder="Type your message…" />
    <button id="send-btn">Send</button>
  </div>
</div>

<script>
const API_URL = "https://chatbot-mvp-python.onrender.com/chat";
const chatBox = document.getElementById("chat-box");
const input = document.getElementById("user-input");
const suggestionsDiv = document.getElementById("suggestions");

let sessionId = "web-" + Math.random().toString(36).substr(2, 9);

function addMessage(sender, text) {
  const row = document.createElement("div");
  row.className = "row " + sender;
  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.innerHTML = text;
  row.appendChild(bubble);
  chatBox.appendChild(row);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function renderSuggestions(suggest=[]) {
  suggestionsDiv.innerHTML = "";
  suggest.forEach(txt => {
    const btn = document.createElement("button");
    btn.textContent = txt;
    btn.onclick = () => { input.value = txt; sendMessage(); };
    suggestionsDiv.appendChild(btn);
  });
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  addMessage("user", text + " <span class='meta'>✓ Sent</span>");
  input.value = "";

  try {
    const res = await fetch(API_URL + "?session_id=" + sessionId, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ message:text })
    });
    const data = await res.json();
    addMessage("bot", data.reply);
    renderSuggestions(data.suggest || []);
  } catch(e) {
    addMessage("bot","⚠️ Error contacting server.");
  }
}

function restartChat() {
  sessionId = "web-" + Math.random().toString(36).substr(2, 9);
  chatBox.innerHTML = "";
  suggestionsDiv.innerHTML = "";
  sendMessage(); // trigger intro
}

document.getElementById("send-btn").addEventListener("click", sendMessage);
input.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

// intro
sendMessage();
</script>
</body>
</html>
