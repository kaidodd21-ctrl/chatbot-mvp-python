<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kai • Virtual Assistant</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="chat-container">
    <header>
      <h2>Kai • Virtual Assistant</h2>
      <div class="status">🟢 Online now</div>
      <button onclick="restartChat()">⟳ Restart</button>
    </header>

    <div id="chat-box"></div>

    <div id="input-container">
      <input id="user-input" type="text" placeholder="Type a message..." />
      <button onclick="handleSend()">Send</button>
    </div>
  </div>

  <script>
  // 🔗 Backend on Render
  const BACKEND_URL = "https://kai-chatbot-backend.onrender.com/chat";
  let sessionId = null;

  function addUserMessage(text) {
    const chatBox = document.getElementById("chat-box");
    const msgWrapper = document.createElement("div");
    msgWrapper.className = "message user";
    const statusId = "status-" + Date.now();

    msgWrapper.innerHTML = `
      <div class="avatar"></div>
      <div class="bubble">${text}</div>
      <div class="status" id="${statusId}">✓ Sent</div>
    `;

    chatBox.appendChild(msgWrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
    return document.getElementById(statusId);
  }

  function addBotMessage(text) {
    const chatBox = document.getElementById("chat-box");
    const msgWrapper = document.createElement("div");
    msgWrapper.className = "message bot";
    msgWrapper.innerHTML = `
      <div class="avatar"></div>
      <div class="bubble">${text}</div>
    `;
    chatBox.appendChild(msgWrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function addSuggestions(suggestions) {
    const chatBox = document.getElementById("chat-box");
    const suggBox = document.createElement("div");
    suggBox.className = "suggestions";

    suggestions.forEach((s, i) => {
      const btn = document.createElement("button");
      btn.innerText = s;
      btn.onclick = () => sendMessage(s);
      btn.style.animationDelay = `${0.1 + i * 0.15}s`;
      suggBox.appendChild(btn);
    });

    chatBox.appendChild(suggBox);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function showTyping() {
    const chatBox = document.getElementById("chat-box");
    const typingDiv = document.createElement("div");
    typingDiv.id = "typing";
    typingDiv.className = "message bot";
    typingDiv.innerHTML = `
      <div class="avatar"></div>
      <div class="bubble typing">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>`;
    chatBox.appendChild(typingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function hideTyping() {
    const typingDiv = document.getElementById("typing");
    if (typingDiv) typingDiv.remove();
  }

  async function sendMessage(text) {
    const statusEl = addUserMessage(text);
    document.getElementById("user-input").value = "";

    showTyping();

    try {
      const res = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text, session_id: sessionId })
      });

      const data = await res.json();
      sessionId = data.session_id;

      setTimeout(() => {
        hideTyping();
        addBotMessage(data.reply);
        if (data.suggestions.length > 0) {
          setTimeout(() => addSuggestions(data.suggestions), 400);
        }
        statusEl.innerText = "✓✓ Read";
      }, Math.floor(Math.random() * 1000) + 500);

    } catch (error) {
      hideTyping();
      addBotMessage("⚠️ Oops, I couldn’t connect to the server. Please try again.");
      statusEl.innerText = "Failed";
    }
  }

  function handleSend() {
    const input = document.getElementById("user-input").value.trim();
    if (input) sendMessage(input);
  }

  function restartChat() {
    document.getElementById("chat-box").innerHTML = "";
    sessionId = null;
    addBotMessage("Hi 👋 I’m Kai, your assistant. How can I help today?");
    setTimeout(() => addSuggestions(["Make a booking", "Opening hours", "Contact details"]), 400);
  }

  window.onload = restartChat;
  </script>
</body>
</html>

